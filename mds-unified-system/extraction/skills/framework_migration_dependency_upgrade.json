{
  "id": "framework_migration_dependency_upgrade",
  "name": "dependency-upgrade",
  "source": "framework-migration",
  "originalPath": "plugins/framework-migration/skills/dependency-upgrade/SKILL.md",
  "activationCriteria": "Manage major dependency version upgrades with compatibility analysis, staged rollout, and comprehensive testing. Use when upgrading framework versions, updating major dependencies, or managing breakin",
  "tier1_metadata": "dependency-upgrade: Manage major dependency version upgrades with compatibility analysis, staged rollout, and comprehens",
  "tier2_instructions": "# Dependency Upgrade\n\nMaster major dependency version upgrades, compatibility analysis, staged upgrade strategies, and comprehensive testing approaches.\n\n## When to Use This Skill\n\n- Upgrading major framework versions\n- Updating security-vulnerable dependencies\n- Modernizing legacy dependencies\n- Resolving dependency conflicts\n- Planning incremental upgrade paths\n- Testing compatibility matrices\n- Automating dependency updates\n\n## Semantic Versioning Review\n\n```\nMAJOR.MINOR.PATCH (e.g., 2.3.1)\n\nMAJOR: Breaking changes\nMINOR: New features, backward compatible\nPATCH: Bug fixes, backward compatible\n\n^2.3.1 = >=2.3.1 <3.0.0 (minor updates)\n~2.3.1 = >=2.3.1 <2.4.0 (patch updates)\n2.3.1 = exact version\n```\n\n## Dependency Analysis\n\n### Audit Dependencies\n```bash\n# npm\nnpm outdated\nnpm audit\nnpm audit fix\n\n# yarn\nyarn outdated\nyarn audit\n\n# Check for major updates\nnpx npm-check-updates\nnpx npm-check-updates -u  # Update package.json\n```\n\n### Analyze Dependency Tree\n```bash\n# See why a package is installed\nnpm ls package-name\nyarn why package-name\n\n# Find duplicate packages\nnpm dedupe\nyarn dedupe\n\n# Visualize dependencies\nnpx madge --image graph.png src/\n```\n\n## Compatibility Matrix\n\n```javascript\n// compatibility-matrix.js\nconst compatibilityMatrix = {\n  'react': {\n    '16.x': {\n      'react-dom': '^16.0.0',\n      'react-router-dom': '^5.0.0',\n      '@testing-library/react': '^11.0.0'\n    },\n    '17.x': {\n      'react-dom': '^17.0.0',\n      'react-router-dom': '^5.0.0 || ^6.0.0',\n      '@testing-library/react': '^12.0.0'\n    },\n    '18.x': {\n      'react-dom': '^18.0.0',\n      'react-router-dom': '^6.0.0',\n      '@testing-library/react': '^13.0.0'\n    }\n  }\n};\n\nfunction checkCompatibility(packages) {\n  // Validate package versions against matrix\n}\n```\n\n## Staged Upgrade Strategy\n\n### Phase 1: Planning\n```bash\n# 1. Identify current versions\nnpm list --depth=0\n\n# 2. Check for breaking changes\n# Read CHANGELOG.md and MIGRATION.md\n\n# 3. Create upgrade plan\necho \"Upgrade order:\n",
  "tier3_resources": "1. TypeScript\n2. React\n3. React Router\n4. Testing libraries\n5. Build tools\" > UPGRADE_PLAN.md\n```\n\n### Phase 2: Incremental Updates\n```bash\n# Don't upgrade everything at once!\n\n# Step 1: Update TypeScript\nnpm install typescript@latest\n\n# Test\nnpm run test\nnpm run build\n\n# Step 2: Update React (one major version at a time)\nnpm install react@17 react-dom@17\n\n# Test again\nnpm run test\n\n# Step 3: Continue with other packages\nnpm install react-router-dom@6\n\n# And so on...\n```\n\n### Phase 3: Validation\n```javascript\n// tests/compatibility.test.js\ndescribe('Dependency Compatibility', () => {\n  it('should have compatible React versions', () => {\n    const reactVersion = require('react/package.json').version;\n    const reactDomVersion = require('react-dom/package.json').version;\n\n    expect(reactVersion).toBe(reactDomVersion);\n  });\n\n  it('should not have peer dependency warnings', () => {\n    // Run npm ls and check for warnings\n  });\n});\n```\n\n## Breaking Change Handling\n\n### Identifying Breaking Changes\n```bash\n# Use changelog parsers\nnpx changelog-parser react 16.0.0 17.0.0\n\n# Or manually check\ncurl https://raw.githubusercontent.com/facebook/react/main/CHANGELOG.md\n```\n\n### Codemod for Automated Fixes\n```bash\n# React upgrade codemods\nnpx react-codeshift <transform> <path>\n\n# Example: Update lifecycle methods\nnpx react-codeshift \\\n  --parser tsx \\\n  --transform react-codeshift/transforms/rename-unsafe-lifecycles.js \\\n  src/\n```\n\n### Custom Migration Script\n```javascript\n// migration-script.js\nconst fs = require('fs');\nconst glob = require('glob');\n\nglob('src/**/*.tsx', (err, files) => {\n  files.forEach(file => {\n    let content = fs.readFileSync(file, 'utf8');\n\n    // Replace old API with new API\n    content = content.replace(\n      /componentWillMount/g,\n      'UNSAFE_componentWillMount'\n    );\n\n    // Update imports\n    content = content.replace(\n      /import { Component } from 'react'/g,\n      \"import React, { Component } from 'react'\"\n    );\n\n    fs.writeFileSync(file, content);\n  });\n});\n```\n\n## Testing Strategy\n\n### Unit Tests\n```javascript\n// Ensure tests pass before and after upgrade\nnpm run test\n\n// Update test utilities if needed\nnpm install @testing-library/react@latest\n```\n\n### Integration Tests\n```javascript\n// tests/integration/app.test.js\ndescribe('App Integration', () => {\n  it('should render without crashing', () => {\n    render(<App />);\n  });\n\n  it('should handle navigation', () => {\n    const { getByText } = render(<App />);\n    fireEvent.click(getByText('Navigate'));\n    expect(screen.getByText('New Page')).toBeInTheDocument();\n  });\n});\n```\n\n### Visual Regression Tests\n```javascript\n// visual-regression.test.js\ndescribe('Visual Regression', () => {\n  it('should match snapshot', () => {\n    const { container } = render(<App />);\n    expect(container.firstChild).toMatchSnapshot();\n  });\n});\n```\n\n### E2E Tests\n```javascript\n// cypress/e2e/app.cy.js\ndescribe('E2E Tests', () => {\n  it('should complete user flow', () => {\n    cy.visit('/",
  "tokenEstimate": {
    "tier1": 16.900000000000002,
    "tier2": 327.6,
    "tier3": 1114.1000000000001
  },
  "fullDefinition": "---\nname: dependency-upgrade\ndescription: Manage major dependency version upgrades with compatibility analysis, staged rollout, and comprehensive testing. Use when upgrading framework versions, updating major dependencies, or managing breaking changes in libraries.\n---\n\n# Dependency Upgrade\n\nMaster major dependency version upgrades, compatibility analysis, staged upgrade strategies, and comprehensive testing approaches.\n\n## When to Use This Skill\n\n- Upgrading major framework versions\n- Updating security-vulnerable dependencies\n- Modernizing legacy dependencies\n- Resolving dependency conflicts\n- Planning incremental upgrade paths\n- Testing compatibility matrices\n- Automating dependency updates\n\n## Semantic Versioning Review\n\n```\nMAJOR.MINOR.PATCH (e.g., 2.3.1)\n\nMAJOR: Breaking changes\nMINOR: New features, backward compatible\nPATCH: Bug fixes, backward compatible\n\n^2.3.1 = >=2.3.1 <3.0.0 (minor updates)\n~2.3.1 = >=2.3.1 <2.4.0 (patch updates)\n2.3.1 = exact version\n```\n\n## Dependency Analysis\n\n### Audit Dependencies\n```bash\n# npm\nnpm outdated\nnpm audit\nnpm audit fix\n\n# yarn\nyarn outdated\nyarn audit\n\n# Check for major updates\nnpx npm-check-updates\nnpx npm-check-updates -u  # Update package.json\n```\n\n### Analyze Dependency Tree\n```bash\n# See why a package is installed\nnpm ls package-name\nyarn why package-name\n\n# Find duplicate packages\nnpm dedupe\nyarn dedupe\n\n# Visualize dependencies\nnpx madge --image graph.png src/\n```\n\n## Compatibility Matrix\n\n```javascript\n// compatibility-matrix.js\nconst compatibilityMatrix = {\n  'react': {\n    '16.x': {\n      'react-dom': '^16.0.0',\n      'react-router-dom': '^5.0.0',\n      '@testing-library/react': '^11.0.0'\n    },\n    '17.x': {\n      'react-dom': '^17.0.0',\n      'react-router-dom': '^5.0.0 || ^6.0.0',\n      '@testing-library/react': '^12.0.0'\n    },\n    '18.x': {\n      'react-dom': '^18.0.0',\n      'react-router-dom': '^6.0.0',\n      '@testing-library/react': '^13.0.0'\n    }\n  }\n};\n\nfunction checkCompatibility(packages) {\n  // Validate package versions against matrix\n}\n```\n\n## Staged Upgrade Strategy\n\n### Phase 1: Planning\n```bash\n# 1. Identify current versions\nnpm list --depth=0\n\n# 2. Check for breaking changes\n# Read CHANGELOG.md and MIGRATION.md\n\n# 3. Create upgrade plan\necho \"Upgrade order:\n1. TypeScript\n2. React\n3. React Router\n4. Testing libraries\n5. Build tools\" > UPGRADE_PLAN.md\n```\n\n### Phase 2: Incremental Updates\n```bash\n# Don't upgrade everything at once!\n\n# Step 1: Update TypeScript\nnpm install typescript@latest\n\n# Test\nnpm run test\nnpm run build\n\n# Step 2: Update React (one major version at a time)\nnpm install react@17 react-dom@17\n\n# Test again\nnpm run test\n\n# Step 3: Continue with other packages\nnpm install react-router-dom@6\n\n# And so on...\n```\n\n### Phase 3: Validation\n```javascript\n// tests/compatibility.test.js\ndescribe('Dependency Compatibility', () => {\n  it('should have compatible React versions', () => {\n    const reactVersion = require('react/package.json').version;\n    const reactDomVersion = require('react-dom/package.json').version;\n\n    expect(reactVersion).toBe(reactDomVersion);\n  });\n\n  it('should not have peer dependency warnings', () => {\n    // Run npm ls and check for warnings\n  });\n});\n```\n\n## Breaking Change Handling\n\n### Identifying Breaking Changes\n```bash\n# Use changelog parsers\nnpx changelog-parser react 16.0.0 17.0.0\n\n# Or manually check\ncurl https://raw.githubusercontent.com/facebook/react/main/CHANGELOG.md\n```\n\n### Codemod for Automated Fixes\n```bash\n# React upgrade codemods\nnpx react-codeshift <transform> <path>\n\n# Example: Update lifecycle methods\nnpx react-codeshift \\\n  --parser tsx \\\n  --transform react-codeshift/transforms/rename-unsafe-lifecycles.js \\\n  src/\n```\n\n### Custom Migration Script\n```javascript\n// migration-script.js\nconst fs = require('fs');\nconst glob = require('glob');\n\nglob('src/**/*.tsx', (err, files) => {\n  files.forEach(file => {\n    let content = fs.readFileSync(file, 'utf8');\n\n    // Replace old API with new API\n    content = content.replace(\n      /componentWillMount/g,\n      'UNSAFE_componentWillMount'\n    );\n\n    // Update imports\n    content = content.replace(\n      /import { Component } from 'react'/g,\n      \"import React, { Component } from 'react'\"\n    );\n\n    fs.writeFileSync(file, content);\n  });\n});\n```\n\n## Testing Strategy\n\n### Unit Tests\n```javascript\n// Ensure tests pass before and after upgrade\nnpm run test\n\n// Update test utilities if needed\nnpm install @testing-library/react@latest\n```\n\n### Integration Tests\n```javascript\n// tests/integration/app.test.js\ndescribe('App Integration', () => {\n  it('should render without crashing', () => {\n    render(<App />);\n  });\n\n  it('should handle navigation', () => {\n    const { getByText } = render(<App />);\n    fireEvent.click(getByText('Navigate'));\n    expect(screen.getByText('New Page')).toBeInTheDocument();\n  });\n});\n```\n\n### Visual Regression Tests\n```javascript\n// visual-regression.test.js\ndescribe('Visual Regression', () => {\n  it('should match snapshot', () => {\n    const { container } = render(<App />);\n    expect(container.firstChild).toMatchSnapshot();\n  });\n});\n```\n\n### E2E Tests\n```javascript\n// cypress/e2e/app.cy.js\ndescribe('E2E Tests', () => {\n  it('should complete user flow', () => {\n    cy.visit('/');\n    cy.get('[data-testid=\"login\"]').click();\n    cy.get('input[name=\"email\"]').type('user@example.com');\n    cy.get('button[type=\"submit\"]').click();\n    cy.url().should('include', '/dashboard');\n  });\n});\n```\n\n## Automated Dependency Updates\n\n### Renovate Configuration\n```json\n// renovate.json\n{\n  \"extends\": [\"config:base\"],\n  \"packageRules\": [\n    {\n      \"matchUpdateTypes\": [\"minor\", \"patch\"],\n      \"automerge\": true\n    },\n    {\n      \"matchUpdateTypes\": [\"major\"],\n      \"automerge\": false,\n      \"labels\": [\"major-update\"]\n    }\n  ],\n  \"schedule\": [\"before 3am on Monday\"],\n  \"timezone\": \"America/New_York\"\n}\n```\n\n### Dependabot Configuration\n```yaml\n# .github/dependabot.yml\nversion: 2\nupdates:\n  - package-ecosystem: \"npm\"\n    directory: \"/\"\n    schedule:\n      interval: \"weekly\"\n    open-pull-requests-limit: 5\n    reviewers:\n      - \"team-leads\"\n    commit-message:\n      prefix: \"chore\"\n      include: \"scope\"\n```\n\n## Rollback Plan\n\n```javascript\n// rollback.sh\n#!/bin/bash\n\n# Save current state\ngit stash\ngit checkout -b upgrade-branch\n\n# Attempt upgrade\nnpm install package@latest\n\n# Run tests\nif npm run test; then\n  echo \"Upgrade successful\"\n  git add package.json package-lock.json\n  git commit -m \"chore: upgrade package\"\nelse\n  echo \"Upgrade failed, rolling back\"\n  git checkout main\n  git branch -D upgrade-branch\n  npm install  # Restore from package-lock.json\nfi\n```\n\n## Common Upgrade Patterns\n\n### Lock File Management\n```bash\n# npm\nnpm install --package-lock-only  # Update lock file only\nnpm ci  # Clean install from lock file\n\n# yarn\nyarn install --frozen-lockfile  # CI mode\nyarn upgrade-interactive  # Interactive upgrades\n```\n\n### Peer Dependency Resolution\n```bash\n# npm 7+: strict peer dependencies\nnpm install --legacy-peer-deps  # Ignore peer deps\n\n# npm 8+: override peer dependencies\nnpm install --force\n```\n\n### Workspace Upgrades\n```bash\n# Update all workspace packages\nnpm install --workspaces\n\n# Update specific workspace\nnpm install package@latest --workspace=packages/app\n```\n\n## Resources\n\n- **references/semver.md**: Semantic versioning guide\n- **references/compatibility-matrix.md**: Common compatibility issues\n- **references/staged-upgrades.md**: Incremental upgrade strategies\n- **references/testing-strategy.md**: Comprehensive testing approaches\n- **assets/upgrade-checklist.md**: Step-by-step checklist\n- **assets/compatibility-matrix.csv**: Version compatibility table\n- **scripts/audit-dependencies.sh**: Dependency audit script\n\n## Best Practices\n\n1. **Read Changelogs**: Understand what changed\n2. **Upgrade Incrementally**: One major version at a time\n3. **Test Thoroughly**: Unit, integration, E2E tests\n4. **Check Peer Dependencies**: Resolve conflicts early\n5. **Use Lock Files**: Ensure reproducible installs\n6. **Automate Updates**: Use Renovate or Dependabot\n7. **Monitor**: Watch for runtime errors post-upgrade\n8. **Document**: Keep upgrade notes\n\n## Upgrade Checklist\n\n```markdown\nPre-Upgrade:\n- [ ] Review current dependency versions\n- [ ] Read changelogs for breaking changes\n- [ ] Create feature branch\n- [ ] Backup current state (git tag)\n- [ ] Run full test suite (baseline)\n\nDuring Upgrade:\n- [ ] Upgrade one dependency at a time\n- [ ] Update peer dependencies\n- [ ] Fix TypeScript errors\n- [ ] Update tests if needed\n- [ ] Run test suite after each upgrade\n- [ ] Check bundle size impact\n\nPost-Upgrade:\n- [ ] Full regression testing\n- [ ] Performance testing\n- [ ] Update documentation\n- [ ] Deploy to staging\n- [ ] Monitor for errors\n- [ ] Deploy to production\n```\n\n## Common Pitfalls\n\n- Upgrading all dependencies at once\n- Not testing after each upgrade\n- Ignoring peer dependency warnings\n- Forgetting to update lock file\n- Not reading breaking change notes\n- Skipping major versions\n- Not having rollback plan\n"
}