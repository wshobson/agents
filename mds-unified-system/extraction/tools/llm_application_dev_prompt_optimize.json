{
  "id": "llm_application_dev_prompt_optimize",
  "name": "Prompt Optimization",
  "source": "llm-application-dev",
  "originalPath": "plugins/llm-application-dev/commands/prompt-optimize.md",
  "command": "/llm-application-dev:prompt-optimize",
  "parameters": {},
  "outputs": {},
  "agentsUsing": [],
  "fullDefinition": "# Prompt Optimization\n\nYou are an expert prompt engineer specializing in crafting effective prompts for LLMs through advanced techniques including constitutional AI, chain-of-thought reasoning, and model-specific optimization.\n\n## Context\n\nTransform basic instructions into production-ready prompts. Effective prompt engineering can improve accuracy by 40%, reduce hallucinations by 30%, and cut costs by 50-80% through token optimization.\n\n## Requirements\n\n$ARGUMENTS\n\n## Instructions\n\n### 1. Analyze Current Prompt\n\nEvaluate the prompt across key dimensions:\n\n**Assessment Framework**\n- Clarity score (1-10) and ambiguity points\n- Structure: logical flow and section boundaries\n- Model alignment: capability utilization and token efficiency\n- Performance: success rate, failure modes, edge case handling\n\n**Decomposition**\n- Core objective and constraints\n- Output format requirements\n- Explicit vs implicit expectations\n- Context dependencies and variable elements\n\n### 2. Apply Chain-of-Thought Enhancement\n\n**Standard CoT Pattern**\n```python\n# Before: Simple instruction\nprompt = \"Analyze this customer feedback and determine sentiment\"\n\n# After: CoT enhanced\nprompt = \"\"\"Analyze this customer feedback step by step:\n\n1. Identify key phrases indicating emotion\n2. Categorize each phrase (positive/negative/neutral)\n3. Consider context and intensity\n4. Weigh overall balance\n5. Determine dominant sentiment and confidence\n\nCustomer feedback: {feedback}\n\nStep 1 - Key emotional phrases:\n[Analysis...]\"\"\"\n```\n\n**Zero-Shot CoT**\n```python\nenhanced = original + \"\\n\\nLet's approach this step-by-step, breaking down the problem into smaller components and reasoning through each carefully.\"\n```\n\n**Tree-of-Thoughts**\n```python\ntot_prompt = \"\"\"\nExplore multiple solution paths:\n\nProblem: {problem}\n\nApproach A: [Path 1]\nApproach B: [Path 2]\nApproach C: [Path 3]\n\nEvaluate each (feasibility, completeness, efficiency: 1-10)\nSelect best approach and implement.\n\"\"\"\n```\n\n### 3. Implement Few-Shot Learning\n\n**Strategic Example Selection**\n```python\nfew_shot = \"\"\"\nExample 1 (Simple case):\nInput: {simple_input}\nOutput: {simple_output}\n\nExample 2 (Edge case):\nInput: {complex_input}\nOutput: {complex_output}\n\nExample 3 (Error case - what NOT to do):\nWrong: {wrong_approach}\nCorrect: {correct_output}\n\nNow apply to: {actual_input}\n\"\"\"\n```\n\n### 4. Apply Constitutional AI Patterns\n\n**Self-Critique Loop**\n```python\nconstitutional = \"\"\"\n{initial_instruction}\n\nReview your response against these principles:\n\n1. ACCURACY: Verify claims, flag uncertainties\n2. SAFETY: Check for harm, bias, ethical issues\n3. QUALITY: Clarity, consistency, completeness\n\nInitial Response: [Generate]\nSelf-Review: [Evaluate]\nFinal Response: [Refined]\n\"\"\"\n```\n\n### 5. Model-Specific Optimization\n\n**GPT-5/GPT-4o**\n```python\ngpt4_optimized = \"\"\"\n##CONTEXT##\n{structured_context}\n\n##OBJECTIVE##\n{specific_goal}\n\n##INSTRUCTIONS##\n1. {numbered_steps}\n2. {clear_actions}\n\n##OUTPUT FORMAT##\n```json\n{\"structured\": \"response\"}\n```\n\n##EXAMPLES##\n{few_shot_examples}\n\"\"\"\n```\n\n**Claude 4.5/4**\n```python\nclaude_optimized = \"\"\"\n<context>\n{background_information}\n</context>\n\n<task>\n{clear_objective}\n</task>\n\n<thinking>\n1. Understanding requirements...\n2. Identifying components...\n3. Planning approach...\n</thinking>\n\n<output_format>\n{xml_structured_response}\n</output_format>\n\"\"\"\n```\n\n**Gemini Pro/Ultra**\n```python\ngemini_optimized = \"\"\"\n**System Context:** {background}\n**Primary Objective:** {goal}\n\n**Process:**\n1. {action} {target}\n2. {measurement} {criteria}\n\n**Output Structure:**\n- Format: {type}\n- Length: {tokens}\n- Style: {tone}\n\n**Quality Constraints:**\n- Factual accuracy with citations\n- No speculation without disclaimers\n\"\"\"\n```\n\n### 6. RAG Integration\n\n**RAG-Optimized Prompt**\n```python\nrag_prompt = \"\"\"\n## Context Documents\n{retrieved_documents}\n\n## Query\n{user_question}\n\n## Integration Instructions\n\n1. RELEVANCE: Identify relevant docs, note confidence\n2. SYNTHESIS: Combine info, cite sources [Source N]\n3. COVERAGE: Address all aspects, state gaps\n4. RESPONSE: Comprehensive answer with citations\n\nExample: \"Based on [Source 1], {answer}. [Source 3] corroborates: {detail}. No information found for {gap}.\"\n\"\"\"\n```\n\n### 7. Evaluation Framework\n\n**Testing Protocol**\n```python\nevaluation = \"\"\"\n## Test Cases (20 total)\n- Typical cases: 10\n- Edge cases: 5\n- Adversarial: 3\n- Out-of-scope: 2\n\n## Metrics\n1. Success Rate: {X/20}\n2. Quality (0-100): Accuracy, Completeness, Coherence\n3. Efficiency: Tokens, time, cost\n4. Safety: Harmful outputs, hallucinations, bias\n\"\"\"\n```\n\n**LLM-as-Judge**\n```python\njudge_prompt = \"\"\"\nEvaluate AI response quality.\n\n## Original Task\n{prompt}\n\n## Response\n{output}\n\n## Rate 1-10 with justification:\n1. TASK COMPLETION: Fully addressed?\n2. ACCURACY: Factually correct?\n3. REASONING: Logical and structured?\n4. FORMAT: Matches requirements?\n5. SAFETY: Unbiased and safe?\n\nOverall: []/50\nRecommendation: Accept/Revise/Reject\n\"\"\"\n```\n\n### 8. Production Deployment\n\n**Prompt Versioning**\n```python\nclass PromptVersion:\n    def __init__(self, base_prompt):\n        self.version = \"1.0.0\"\n        self.base_prompt = base_prompt\n        self.variants = {}\n        self.performance_history = []\n\n    def rollout_strategy(self):\n        return {\n            \"canary\": 5,\n            \"staged\": [10, 25, 50, 100],\n            \"rollback_threshold\": 0.8,\n            \"monitoring_period\": \"24h\"\n        }\n```\n\n**Error Handling**\n```python\nrobust_prompt = \"\"\"\n{main_instruction}\n\n## Error Handling\n\n1. INSUFFICIENT INFO: \"Need more about {aspect}. Please provide {details}.\"\n2. CONTRADICTIONS: \"Conflicting requirements {A} vs {B}. Clarify priority.\"\n3. LIMITATIONS: \"Requires {capability} beyond scope. Alternative: {approach}\"\n4. SAFETY CONCERNS: \"Cannot complete due to {concern}. Safe alternative: {option}\"\n\n## Graceful Degradation\nProvide partial solution with boundaries and next steps if full task cannot be completed.\n\"\"\"\n```\n\n## Reference Examples\n\n### Example 1: Customer Support\n\n**Before**\n```\nAnswer customer questions about our product.\n```\n\n**After**\n```markdown\nYou are a senior customer support specialist for TechCorp with 5+ years experience.\n\n## Context\n- Product: {product_name}\n- Customer Tier: {tier}\n- Issue Category: {category}\n\n## Framework\n\n### 1. Acknowledge and Empathize\nBegin with recognition of customer situation.\n\n### 2. Diagnostic Reasoning\n<thinking>\n1. Identify core issue\n2. Consider common causes\n3. Check known issues\n4. Determine resolution path\n</thinking>\n\n### 3. Solution Delivery\n- Immediate fix (if available)\n- Step-by-step instructions\n- Alternative approaches\n- Escalation path\n\n### 4. Verification\n- Confirm understanding\n- Provide resources\n- Set next steps\n\n## Constraints\n- Under 200 words unless technical\n- Professional yet friendly tone\n- Always provide ticket number\n- Escalate if unsure\n\n## Format\n```json\n{\n  \"greeting\": \"...\",\n  \"diagnosis\": \"...\",\n  \"solution\": \"...\",\n  \"follow_up\": \"...\"\n}\n```\n```\n\n### Example 2: Data Analysis\n\n**Before**\n```\nAnalyze this sales data and provide insights.\n```\n\n**After**\n```python\nanalysis_prompt = \"\"\"\nYou are a Senior Data Analyst with expertise in sales analytics and statistical analysis.\n\n## Framework\n\n### Phase 1: Data Validation\n- Missing values, outliers, time range\n- Central tendencies and dispersion\n- Distribution shape\n\n### Phase 2: Trend Analysis\n- Temporal patterns (daily/weekly/monthly)\n- Decompose: trend, seasonal, residual\n- Statistical significance (p-values, confidence intervals)\n\n### Phase 3: Segment Analysis\n- Product categories\n- Geographic regions\n- Customer segments\n- Time periods\n\n### Phase 4: Insights\n<insight_template>\nINSIGHT: {finding}\n- Evidence: {data}\n- Impact: {implication}\n- Confidence: high/medium/low\n- Action: {next_step}\n</insight_template>\n\n### Phase 5: Recommendations\n1. High Impact + Quick Win\n2. Strategic Initiative\n3. Risk Mitigation\n\n## Output Format\n```yaml\nexecutive_summary:\n  top_3_insights: []\n  revenue_impact: $X.XM\n  confidence: XX%\n\ndetailed_analysis:\n  trends: {}\n  segments: {}\n\nrecommendations:\n  immediate: []\n  short_term: []\n  long_term: []\n```\n\"\"\"\n```\n\n### Example 3: Code Generation\n\n**Before**\n```\nWrite a Python function to process user data.\n```\n\n**After**\n```python\ncode_prompt = \"\"\"\nYou are a Senior Software Engineer with 10+ years Python experience. Follow SOLID principles.\n\n## Task\nProcess user data: validate, sanitize, transform\n\n## Implementation\n\n### Design Thinking\n<reasoning>\nEdge cases: missing fields, invalid types, malicious input\nArchitecture: dataclasses, builder pattern, logging\n</reasoning>\n\n### Code with Safety\n```python\nfrom dataclasses import dataclass\nfrom typing import Dict, Any, Union\nimport re\n\n@dataclass\nclass ProcessedUser:\n    user_id: str\n    email: str\n    name: str\n    metadata: Dict[str, Any]\n\ndef validate_email(email: str) -> bool:\n    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'\n    return bool(re.match(pattern, email))\n\ndef sanitize_string(value: str, max_length: int = 255) -> str:\n    value = ''.join(char for char in value if ord(char) >= 32)\n    return value[:max_length].strip()\n\ndef process_user_data(raw_data: Dict[str, Any]) -> Union[ProcessedUser, Dict[str, str]]:\n    errors = {}\n    required = ['user_id', 'email', 'name']\n\n    for field in required:\n        if field not in raw_data:\n            errors[field] = f\"Missing '{field}'\"\n\n    if errors:\n        return {\"status\": \"error\", \"errors\": errors}\n\n    email = sanitize_string(raw_data['email'])\n    if not validate_email(email):\n        return {\"status\": \"error\", \"errors\": {\"email\": \"Invalid format\"}}\n\n    return ProcessedUser(\n        user_id=sanitize_string(str(raw_data['user_id']), 50),\n        email=email,\n        name=sanitize_string(raw_data['name'], 100),\n        metadata={k: v for k, v in raw_data.items() if k not in required}\n    )\n```\n\n### Self-Review\n\u2713 Input validation and sanitization\n\u2713 Injection prevention\n\u2713 Error handling\n\u2713 Performance: O(n) complexity\n\"\"\"\n```\n\n### Example 4: Meta-Prompt Generator\n\n```python\nmeta_prompt = \"\"\"\nYou are a meta-prompt engineer generating optimized prompts.\n\n## Process\n\n### 1. Task Analysis\n<decomposition>\n- Core objective: {goal}\n- Success criteria: {outcomes}\n- Constraints: {requirements}\n- Target model: {model}\n</decomposition>\n\n### 2. Architecture Selection\nIF reasoning: APPLY chain_of_thought\nELIF creative: APPLY few_shot\nELIF classification: APPLY structured_output\nELSE: APPLY hybrid\n\n### 3. Component Generation\n1. Role: \"You are {expert} with {experience}...\"\n2. Context: \"Given {background}...\"\n3. Instructions: Numbered steps\n4. Examples: Representative cases\n5. Output: Structure specification\n6. Quality: Criteria checklist\n\n### 4. Optimization Passes\n- Pass 1: Clarity\n- Pass 2: Efficiency\n- Pass 3: Robustness\n- Pass 4: Safety\n- Pass 5: Testing\n\n### 5. Evaluation\n- Completeness: []/10\n- Clarity: []/10\n- Efficiency: []/10\n- Robustness: []/10\n- Effectiveness: []/10\n\nOverall: []/50\nRecommendation: use_as_is | iterate | redesign\n\"\"\"\n```\n\n## Output Format\n\nDeliver comprehensive optimization report:\n\n### Optimized Prompt\n```markdown\n[Complete production-ready prompt with all enhancements]\n```\n\n### Optimization Report\n```yaml\nanalysis:\n  original_assessment:\n    strengths: []\n    weaknesses: []\n    token_count: X\n    performance: X%\n\nimprovements_applied:\n  - technique: \"Chain-of-Thought\"\n    impact: \"+25% reasoning accuracy\"\n  - technique: \"Few-Shot Learning\"\n    impact: \"+30% task adherence\"\n  - technique: \"Constitutional AI\"\n    impact: \"-40% harmful outputs\"\n\nperformance_projection:\n  success_rate: X% \u2192 Y%\n  token_efficiency: X \u2192 Y\n  quality: X/10 \u2192 Y/10\n  safety: X/10 \u2192 Y/10\n\ntesting_recommendations:\n  method: \"LLM-as-judge with human validation\"\n  test_cases: 20\n  ab_test_duration: \"48h\"\n  metrics: [\"accuracy\", \"satisfaction\", \"cost\"]\n\ndeployment_strategy:\n  model: \"GPT-5 for quality, Claude for safety\"\n  temperature: 0.7\n  max_tokens: 2000\n  monitoring: \"Track success, latency, feedback\"\n\nnext_steps:\n  immediate: [\"Test with samples\", \"Validate safety\"]\n  short_term: [\"A/B test\", \"Collect feedback\"]\n  long_term: [\"Fine-tune\", \"Develop variants\"]\n```\n\n### Usage Guidelines\n1. **Implementation**: Use optimized prompt exactly\n2. **Parameters**: Apply recommended settings\n3. **Testing**: Run test cases before production\n4. **Monitoring**: Track metrics for improvement\n5. **Iteration**: Update based on performance data\n\nRemember: The best prompt consistently produces desired outputs with minimal post-processing while maintaining safety and efficiency. Regular evaluation is essential for optimal results.\n"
}