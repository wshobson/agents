{
  "id": "c4_architecture_c4_architecture",
  "name": "C4 Architecture Documentation Workflow",
  "source": "c4-architecture",
  "originalPath": "plugins/c4-architecture/commands/c4-architecture.md",
  "command": "/c4-architecture:c4-architecture",
  "parameters": {},
  "outputs": {},
  "agentsUsing": [],
  "fullDefinition": "# C4 Architecture Documentation Workflow\n\nGenerate comprehensive C4 architecture documentation for an existing repository/codebase using a bottom-up analysis approach.\n\n[Extended thinking: This workflow implements a complete C4 architecture documentation process following the C4 model (Context, Container, Component, Code). It uses a bottom-up approach, starting from the deepest code directories and working upward, ensuring every code element is documented before synthesizing into higher-level abstractions. The workflow coordinates four specialized C4 agents (Code, Component, Container, Context) to create a complete architectural documentation set that serves both technical and non-technical stakeholders.]\n\n## Overview\n\nThis workflow creates comprehensive C4 architecture documentation following the [official C4 model](https://c4model.com/diagrams) by:\n1. **Code Level**: Analyzing every subdirectory bottom-up to create code-level documentation \n2. **Component Level**: Synthesizing code documentation into logical components within containers\n3. **Container Level**: Mapping components to deployment containers with API documentation (shows high-level technology choices)\n4. **Context Level**: Creating high-level system context with personas and user journeys (focuses on people and software systems, not technologies)\n\n**Note**: According to the [C4 model](https://c4model.com/diagrams), you don't need to use all 4 levels of diagram - the system context and container diagrams are sufficient for most software development teams. This workflow generates all levels for completeness, but teams can choose which levels to use.\n\nAll documentation is written to a new `C4-Documentation/` directory in the repository root.\n\n## Phase 1: Code-Level Documentation (Bottom-Up Analysis)\n\n### 1.1 Discover All Subdirectories\n- Use codebase search to identify all subdirectories in the repository\n- Sort directories by depth (deepest first) for bottom-up processing\n- Filter out common non-code directories (node_modules, .git, build, dist, etc.)\n- Create list of directories to process\n\n### 1.2 Process Each Directory (Bottom-Up)\nFor each directory, starting from the deepest:\n\n- Use Task tool with subagent_type=\"c4-architecture::c4-code\"\n- Prompt: |\n  Analyze the code in directory: [directory_path]\n  \n  Create comprehensive C4 Code-level documentation following this structure:\n  \n  1. **Overview Section**:\n     - Name: [Descriptive name for this code directory]\n     - Description: [Short description of what this code does]\n     - Location: [Link to actual directory path relative to repo root]\n     - Language: [Primary programming language(s) used]\n     - Purpose: [What this code accomplishes]\n  \n  2. **Code Elements Section**:\n     - Document all functions/methods with complete signatures:\n       - Function name, parameters (with types), return type\n       - Description of what each function does\n       - Location (file path and line numbers)\n       - Dependencies (what this function depends on)\n     - Document all classes/modules:\n       - Class name, description, location\n       - Methods and their signatures\n       - Dependencies\n  \n  3. **Dependencies Section**:\n     - Internal dependencies (other code in this repo)\n     - External dependencies (libraries, frameworks, services)\n  \n  4. **Relationships Section**:\n     - Optional Mermaid diagram if relationships are complex\n  \n  Save the output as: C4-Documentation/c4-code-[directory-name].md\n  Use a sanitized directory name (replace / with -, remove special chars) for the filename.\n  \n  Ensure the documentation includes:\n  - Complete function signatures with all parameters and types\n  - Links to actual source code locations\n  - All dependencies (internal and external)\n  - Clear, descriptive names and descriptions\n\n- Expected output: c4-code-<directory-name>.md file in C4-Documentation/\n- Context: All files in the directory and its subdirectories\n\n**Repeat for every subdirectory** until all directories have corresponding c4-code-*.md files.\n\n## Phase 2: Component-Level Synthesis\n\n### 2.1 Analyze All Code-Level Documentation\n- Collect all c4-code-*.md files created in Phase 1\n- Analyze code structure, dependencies, and relationships\n- Identify logical component boundaries based on:\n  - Domain boundaries (related business functionality)\n  - Technical boundaries (shared frameworks, libraries)\n  - Organizational boundaries (team ownership, if evident)\n\n### 2.2 Create Component Documentation\nFor each identified component:\n\n- Use Task tool with subagent_type=\"c4-architecture::c4-component\"\n- Prompt: |\n  Synthesize the following C4 Code-level documentation files into a logical component:\n  \n  Code files to analyze:\n  [List of c4-code-*.md file paths]\n  \n  Create comprehensive C4 Component-level documentation following this structure:\n  \n  1. **Overview Section**:\n     - Name: [Component name - descriptive and meaningful]\n     - Description: [Short description of component purpose]\n     - Type: [Application, Service, Library, etc.]\n     - Technology: [Primary technologies used]\n  \n  2. **Purpose Section**:\n     - Detailed description of what this component does\n     - What problems it solves\n     - Its role in the system\n  \n  3. **Software Features Section**:\n     - List all software features provided by this component\n     - Each feature with a brief description\n  \n  4. **Code Elements Section**:\n     - List all c4-code-*.md files contained in this component\n     - Link to each file with a brief description\n  \n  5. **Interfaces Section**:\n     - Document all component interfaces:\n       - Interface name\n       - Protocol (REST, GraphQL, gRPC, Events, etc.)\n       - Description\n       - Operations (function signatures, endpoints, etc.)\n  \n  6. **Dependencies Section**:\n     - Components used (other components this depends on)\n     - External systems (databases, APIs, services)\n  \n  7. **Component Diagram**:\n     - Mermaid diagram showing this component and its relationships\n  \n  Save the output as: C4-Documentation/c4-component-[component-name].md\n  Use a sanitized component name for the filename.\n\n- Expected output: c4-component-<name>.md file for each component\n- Context: All relevant c4-code-*.md files for this component\n\n### 2.3 Create Master Component Index\n- Use Task tool with subagent_type=\"c4-architecture::c4-component\"\n- Prompt: |\n  Create a master component index that lists all components in the system.\n  \n  Based on all c4-component-*.md files created, generate:\n  \n  1. **System Components Section**:\n     - List all components with:\n       - Component name\n       - Short description\n       - Link to component documentation\n  \n  2. **Component Relationships Diagram**:\n     - Mermaid diagram showing all components and their relationships\n     - Show dependencies between components\n     - Show external system dependencies\n  \n  Save the output as: C4-Documentation/c4-component.md\n\n- Expected output: Master c4-component.md file\n- Context: All c4-component-*.md files\n\n## Phase 3: Container-Level Synthesis\n\n### 3.1 Analyze Components and Deployment Definitions\n- Review all c4-component-*.md files\n- Search for deployment/infrastructure definitions:\n  - Dockerfiles\n  - Kubernetes manifests (deployments, services, etc.)\n  - Docker Compose files\n  - Terraform/CloudFormation configs\n  - Cloud service definitions (AWS Lambda, Azure Functions, etc.)\n  - CI/CD pipeline definitions\n\n### 3.2 Map Components to Containers\n- Use Task tool with subagent_type=\"c4-architecture::c4-container\"\n- Prompt: |\n  Synthesize components into containers based on deployment definitions.\n  \n  Component documentation:\n  [List of all c4-component-*.md file paths]\n  \n  Deployment definitions found:\n  [List of deployment config files: Dockerfiles, K8s manifests, etc.]\n  \n  Create comprehensive C4 Container-level documentation following this structure:\n  \n  1. **Containers Section** (for each container):\n     - Name: [Container name]\n     - Description: [Short description of container purpose and deployment]\n     - Type: [Web Application, API, Database, Message Queue, etc.]\n     - Technology: [Primary technologies: Node.js, Python, PostgreSQL, etc.]\n     - Deployment: [Docker, Kubernetes, Cloud Service, etc.]\n  \n  2. **Purpose Section** (for each container):\n     - Detailed description of what this container does\n     - How it's deployed\n     - Its role in the system\n  \n  3. **Components Section** (for each container):\n     - List all components deployed in this container\n     - Link to component documentation\n  \n  4. **Interfaces Section** (for each container):\n     - Document all container APIs and interfaces:\n       - API/Interface name\n       - Protocol (REST, GraphQL, gRPC, Events, etc.)\n       - Description\n       - Link to OpenAPI/Swagger/API Spec file\n       - List of endpoints/operations\n  \n  5. **API Specifications**:\n     - For each container API, create an OpenAPI 3.1+ specification\n     - Save as: C4-Documentation/apis/[container-name]-api.yaml\n     - Include:\n       - All endpoints with methods (GET, POST, etc.)\n       - Request/response schemas\n       - Authentication requirements\n       - Error responses\n  \n  6. **Dependencies Section** (for each container):\n     - Containers used (other containers this depends on)\n     - External systems (databases, third-party APIs, etc.)\n     - Communication protocols\n  \n  7. **Infrastructure Section** (for each container):\n     - Link to deployment config (Dockerfile, K8s manifest, etc.)\n     - Scaling strategy\n     - Resource requirements (CPU, memory, storage)\n  \n  8. **Container Diagram**:\n     - Mermaid diagram showing all containers and their relationships\n     - Show communication protocols\n     - Show external system dependencies\n  \n  Save the output as: C4-Documentation/c4-container.md\n\n- Expected output: c4-container.md with all containers and API specifications\n- Context: All component documentation and deployment definitions\n\n## Phase 4: Context-Level Documentation\n\n### 4.1 Analyze System Documentation\n- Review container and component documentation\n- Search for system documentation:\n  - README files\n  - Architecture documentation\n  - Requirements documents\n  - Design documents\n  - Test files (to understand system behavior)\n  - API documentation\n  - User documentation\n\n### 4.2 Create Context Documentation\n- Use Task tool with subagent_type=\"c4-architecture::c4-context\"\n- Prompt: |\n  Create comprehensive C4 Context-level documentation for the system.\n  \n  Container documentation: C4-Documentation/c4-container.md\n  Component documentation: C4-Documentation/c4-component.md\n  System documentation: [List of README, architecture docs, requirements, etc.]\n  Test files: [List of test files that show system behavior]\n  \n  Create comprehensive C4 Context-level documentation following this structure:\n  \n  1. **System Overview Section**:\n     - Short Description: [One-sentence description of what the system does]\n     - Long Description: [Detailed description of system purpose, capabilities, problems solved]\n  \n  2. **Personas Section**:\n     - For each persona (human users and programmatic \"users\"):\n       - Persona name\n       - Type (Human User / Programmatic User / External System)\n       - Description (who they are, what they need)\n       - Goals (what they want to achieve)\n       - Key features used\n  \n  3. **System Features Section**:\n     - For each high-level feature:\n       - Feature name\n       - Description (what this feature does)\n       - Users (which personas use this feature)\n       - Link to user journey map\n  \n  4. **User Journeys Section**:\n     - For each key feature and persona:\n       - Journey name: [Feature Name] - [Persona Name] Journey\n       - Step-by-step journey:\n         1. [Step 1]: [Description]\n         2. [Step 2]: [Description]\n         ...\n       - Include all system touchpoints\n     - For programmatic users (external systems, APIs):\n       - Integration journey with step-by-step process\n  \n  5. **External Systems and Dependencies Section**:\n     - For each external system:\n       - System name\n       - Type (Database, API, Service, Message Queue, etc.)\n       - Description (what it provides)\n       - Integration type (API, Events, File Transfer, etc.)\n       - Purpose (why the system depends on this)\n  \n  6. **System Context Diagram**:\n     - Mermaid C4Context diagram showing:\n       - The system (as a box in the center)\n       - All personas (users) around it\n       - All external systems around it\n       - Relationships and data flows\n       - Use C4Context notation for proper C4 diagram\n  \n  7. **Related Documentation Section**:\n     - Links to container documentation\n     - Links to component documentation\n  \n  Save the output as: C4-Documentation/c4-context.md\n  \n  Ensure the documentation is:\n  - Understandable by non-technical stakeholders\n  - Focuses on system purpose, users, and external relationships\n  - Includes comprehensive user journey maps\n  - Identifies all external systems and dependencies\n\n- Expected output: c4-context.md with complete system context\n- Context: All container, component, and system documentation\n\n## Configuration Options\n\n- `target_directory`: Root directory to analyze (default: current repository root)\n- `exclude_patterns`: Patterns to exclude (default: node_modules, .git, build, dist, etc.)\n- `output_directory`: Where to write C4 documentation (default: C4-Documentation/)\n- `include_tests`: Whether to analyze test files for context (default: true)\n- `api_format`: Format for API specs (default: openapi)\n\n## Success Criteria\n\n- \u2705 Every subdirectory has a corresponding c4-code-*.md file\n- \u2705 All code-level documentation includes complete function signatures\n- \u2705 Components are logically grouped with clear boundaries\n- \u2705 All components have interface documentation\n- \u2705 Master component index created with relationship diagram\n- \u2705 Containers map to actual deployment units\n- \u2705 All container APIs documented with OpenAPI/Swagger specs\n- \u2705 Container diagram shows deployment architecture\n- \u2705 System context includes all personas (human and programmatic)\n- \u2705 User journeys documented for all key features\n- \u2705 All external systems and dependencies identified\n- \u2705 Context diagram shows system, users, and external systems\n- \u2705 Documentation is organized in C4-Documentation/ directory\n\n## Output Structure\n\n```\nC4-Documentation/\n\u251c\u2500\u2500 c4-code-*.md              # Code-level docs (one per directory)\n\u251c\u2500\u2500 c4-component-*.md          # Component-level docs (one per component)\n\u251c\u2500\u2500 c4-component.md            # Master component index\n\u251c\u2500\u2500 c4-container.md            # Container-level docs\n\u251c\u2500\u2500 c4-context.md              # Context-level docs\n\u2514\u2500\u2500 apis/                      # API specifications\n    \u251c\u2500\u2500 [container]-api.yaml   # OpenAPI specs for each container\n    \u2514\u2500\u2500 ...\n```\n\n## Coordination Notes\n\n- **Bottom-up processing**: Process directories from deepest to shallowest\n- **Incremental synthesis**: Each level builds on the previous level's documentation\n- **Complete coverage**: Every directory must have code-level documentation before synthesis\n- **Link consistency**: All documentation files link to each other appropriately\n- **API documentation**: Container APIs must have OpenAPI/Swagger specifications\n- **Stakeholder-friendly**: Context documentation should be understandable by non-technical stakeholders\n- **Mermaid diagrams**: Use proper C4 Mermaid notation for all diagrams\n\n## Example Usage\n\n```bash\n/c4-architecture:c4-architecture\n```\n\nThis will:\n1. Walk through all subdirectories bottom-up\n2. Create c4-code-*.md for each directory\n3. Synthesize into components\n4. Map to containers with API docs\n5. Create system context with personas and journeys\n\nAll documentation written to: C4-Documentation/\n\n"
}